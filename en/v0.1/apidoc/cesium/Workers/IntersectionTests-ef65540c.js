/*! For license information please see IntersectionTests-ef65540c.js.LICENSE.txt */
define(["exports","./Matrix2-21f90abf","./defaultValue-4607806f","./RuntimeError-cef79f54","./Transforms-c450597e","./ComponentDatatype-4028c72d"],(function(t,n,e,a,i,r){"use strict";const s={};function o(t,n,e){const a=t+n;return r.CesiumMath.sign(t)!==r.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}s.computeDiscriminant=function(t,n,e){return n*n-4*t*e},s.computeRealRoots=function(t,n,e){let a;if(0===t)return 0===n?[]:[-e/n];if(0===n){if(0===e)return[0,0];const n=Math.abs(e),i=Math.abs(t);if(n<i&&n/i<r.CesiumMath.EPSILON14)return[0,0];if(n>i&&i/n<r.CesiumMath.EPSILON14)return[];if(a=-e/t,a<0)return[];const s=Math.sqrt(a);return[-s,s]}if(0===e)return a=-n/t,a<0?[a,0]:[0,a];const i=o(n*n,-4*t*e,r.CesiumMath.EPSILON14);if(i<0)return[];const s=-.5*o(n,r.CesiumMath.sign(n)*Math.sqrt(i),r.CesiumMath.EPSILON14);return n>0?[s/t,e/s]:[e/s,s/t]};const c={};function u(t,n,e,a){const i=t,r=n/3,s=e/3,c=a,l=i*s,f=r*c,m=r*r,d=s*s,g=i*s-m,p=i*c-r*s,w=r*c-d,R=4*g*w-p*p;let S,x;if(R<0){let t,n,e;m*f>=l*d?(t=i,n=g,e=-2*r*g+i*p):(t=c,n=w,e=-c*p+2*s*w);const a=-(e<0?-1:1)*Math.abs(t)*Math.sqrt(-R);x=-e+a;const y=x/2,P=y<0?-Math.pow(-y,1/3):Math.pow(y,1/3),b=x===a?-P:-n/P;return S=n<=0?P+b:-e/(P*P+b*b+n),m*f>=l*d?[(S-r)/i]:[-c/(S+s)]}const y=g,P=-2*r*g+i*p,b=w,q=-c*p+2*s*w,L=Math.sqrt(R),I=Math.sqrt(3)/2;let E=Math.abs(Math.atan2(i*L,-P)/3);S=2*Math.sqrt(-y);let z=Math.cos(E);x=S*z;let T=S*(-z/2-I*Math.sin(E));const v=x+T>2*r?x-r:T-r,U=i,W=v/U;E=Math.abs(Math.atan2(c*L,-q)/3),S=2*Math.sqrt(-b),z=Math.cos(E),x=S*z,T=S*(-z/2-I*Math.sin(E));const B=-c,V=x+T<2*s?x+s:T+s,Z=B/V,D=-v*V-U*B,A=(s*D-r*(v*B))/(-r*D+s*(U*V));return W<=A?W<=Z?A<=Z?[W,A,Z]:[W,Z,A]:[Z,W,A]:W<=Z?[A,W,Z]:A<=Z?[A,Z,W]:[Z,A,W]}c.computeDiscriminant=function(t,n,e,a){const i=n*n,r=e*e;return 18*t*n*e*a+i*r-t*t*27*(a*a)-4*(t*r*e+i*n*a)},c.computeRealRoots=function(t,n,e,a){let i,r;if(0===t)return s.computeRealRoots(n,e,a);if(0===n){if(0===e){if(0===a)return[0,0,0];r=-a/t;const n=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[n,n,n]}return 0===a?(i=s.computeRealRoots(t,0,e),0===i.Length?[0]:[i[0],0,i[1]]):u(t,0,e,a)}return 0===e?0===a?(r=-n/t,r<0?[r,0,0]:[0,0,r]):u(t,n,0,a):0===a?(i=s.computeRealRoots(t,n,e),0===i.length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]):u(t,n,e,a)};const l={};function C(t,n,e,a){const i=t*t,l=n-3*i/8,f=e-n*t/2+i*t/8,m=a-e*t/4+n*i/16-3*i*i/256,d=c.computeRealRoots(1,2*l,l*l-4*m,-f*f);if(d.length>0){const n=-t/4,e=d[d.length-1];if(Math.abs(e)<r.CesiumMath.EPSILON14){const t=s.computeRealRoots(1,l,m);if(2===t.length){const e=t[0],a=t[1];let i;if(e>=0&&a>=0){const t=Math.sqrt(e),i=Math.sqrt(a);return[n-i,n-t,n+t,n+i]}if(e>=0&&a<0)return i=Math.sqrt(e),[n-i,n+i];if(e<0&&a>=0)return i=Math.sqrt(a),[n-i,n+i]}return[]}if(e>0){const t=Math.sqrt(e),a=(l+e-f/t)/2,i=(l+e+f/t)/2,r=s.computeRealRoots(1,t,a),c=s.computeRealRoots(1,-t,i);return 0!==r.length?(r[0]+=n,r[1]+=n,0!==c.length?(c[0]+=n,c[1]+=n,r[1]<=c[0]?[r[0],r[1],c[0],c[1]]:c[1]<=r[0]?[c[0],c[1],r[0],r[1]]:r[0]>=c[0]&&r[1]<=c[1]?[c[0],r[0],r[1],c[1]]:c[0]>=r[0]&&c[1]<=r[1]?[r[0],c[0],c[1],r[1]]:r[0]>c[0]&&r[0]<c[1]?[c[0],r[0],c[1],r[1]]:[r[0],c[0],r[1],c[1]]):r):0!==c.length?(c[0]+=n,c[1]+=n,c):[]}}return[]}function M(t,n,e,a){const i=t*t,l=-2*n,f=e*t+n*n-4*a,m=i*a-e*n*t+e*e,d=c.computeRealRoots(1,l,f,m);if(d.length>0){const c=d[0],l=n-c,f=l*l,m=t/2,g=l/2,p=f-4*a,w=f+4*Math.abs(a),R=i-4*c,S=i+4*Math.abs(c);let x,y,P,b,q,L;if(c<0||p*S<R*w){const n=Math.sqrt(R);x=n/2,y=0===n?0:(t*g-e)/n}else{const n=Math.sqrt(p);x=0===n?0:(t*g-e)/n,y=n/2}0===m&&0===x?(P=0,b=0):r.CesiumMath.sign(m)===r.CesiumMath.sign(x)?(P=m+x,b=c/P):(b=m-x,P=c/b),0===g&&0===y?(q=0,L=0):r.CesiumMath.sign(g)===r.CesiumMath.sign(y)?(q=g+y,L=a/q):(L=g-y,q=a/L);const I=s.computeRealRoots(1,P,q),E=s.computeRealRoots(1,b,L);if(0!==I.length)return 0!==E.length?I[1]<=E[0]?[I[0],I[1],E[0],E[1]]:E[1]<=I[0]?[E[0],E[1],I[0],I[1]]:I[0]>=E[0]&&I[1]<=E[1]?[E[0],I[0],I[1],E[1]]:E[0]>=I[0]&&E[1]<=I[1]?[I[0],E[0],E[1],I[1]]:I[0]>E[0]&&I[0]<E[1]?[E[0],I[0],E[1],I[1]]:[I[0],E[0],I[1],E[1]]:I;if(0!==E.length)return E}return[]}function h(t,a){a=n.Cartesian3.clone(e.defaultValue(a,n.Cartesian3.ZERO)),n.Cartesian3.equals(a,n.Cartesian3.ZERO)||n.Cartesian3.normalize(a,a),this.origin=n.Cartesian3.clone(e.defaultValue(t,n.Cartesian3.ZERO)),this.direction=a}l.computeDiscriminant=function(t,n,e,a,i){const r=t*t,s=n*n,c=s*n,l=e*e,f=l*e,m=a*a,d=m*a,g=i*i;return s*l*m-4*c*d-4*t*f*m+18*t*n*e*d-27*r*m*m+r*t*256*(g*i)+i*(18*c*e*a-4*s*f+16*t*l*l-80*t*n*l*a-6*t*s*m+144*r*e*m)+g*(144*t*s*e-27*s*s-128*r*l-192*r*n*a)},l.computeRealRoots=function(t,n,e,a,i){if(Math.abs(t)<r.CesiumMath.EPSILON15)return c.computeRealRoots(n,e,a,i);const s=n/t,l=e/t,f=a/t,m=i/t;let d=s<0?1:0;switch(d+=l<0?d+1:d,d+=f<0?d+1:d,d+=m<0?d+1:d,d){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return C(s,l,f,m);case 1:case 2:case 5:case 8:case 11:return M(s,l,f,m);default:return}},h.clone=function(t,a){if(e.defined(t))return e.defined(a)?(a.origin=n.Cartesian3.clone(t.origin),a.direction=n.Cartesian3.clone(t.direction),a):new h(t.origin,t.direction)},h.getPoint=function(t,a,i){return e.defined(i)||(i=new n.Cartesian3),i=n.Cartesian3.multiplyByScalar(t.direction,a,i),n.Cartesian3.add(t.origin,i,i)};const f={rayPlane:function(t,a,i){e.defined(i)||(i=new n.Cartesian3);const s=t.origin,c=t.direction,l=a.normal,f=n.Cartesian3.dot(l,c);if(Math.abs(f)<r.CesiumMath.EPSILON15)return;const m=(-a.distance-n.Cartesian3.dot(l,s))/f;return m<0?void 0:(i=n.Cartesian3.multiplyByScalar(c,m,i),n.Cartesian3.add(s,i,i))}},m=new n.Cartesian3,d=new n.Cartesian3,g=new n.Cartesian3,p=new n.Cartesian3,w=new n.Cartesian3;f.rayTriangleParametric=function(t,a,i,s,c){c=e.defaultValue(c,!1);const l=t.origin,f=t.direction,R=n.Cartesian3.subtract(i,a,m),S=n.Cartesian3.subtract(s,a,d),x=n.Cartesian3.cross(f,S,g),y=n.Cartesian3.dot(R,x);let P,b,q,L,I;if(c){if(y<r.CesiumMath.EPSILON6)return;if(P=n.Cartesian3.subtract(l,a,p),q=n.Cartesian3.dot(P,x),q<0||q>y)return;if(b=n.Cartesian3.cross(P,R,w),L=n.Cartesian3.dot(f,b),L<0||q+L>y)return;I=n.Cartesian3.dot(S,b)/y}else{if(Math.abs(y)<r.CesiumMath.EPSILON6)return;const t=1/y;if(P=n.Cartesian3.subtract(l,a,p),q=n.Cartesian3.dot(P,x)*t,q<0||q>1)return;if(b=n.Cartesian3.cross(P,R,w),L=n.Cartesian3.dot(f,b)*t,L<0||q+L>1)return;I=n.Cartesian3.dot(S,b)*t}return I},f.rayTriangle=function(t,a,i,r,s,c){const l=f.rayTriangleParametric(t,a,i,r,s);if(e.defined(l)&&!(l<0))return e.defined(c)||(c=new n.Cartesian3),n.Cartesian3.multiplyByScalar(t.direction,l,c),n.Cartesian3.add(t.origin,c,c)};const R=new h;f.lineSegmentTriangle=function(t,a,i,r,s,c,l){const m=R;n.Cartesian3.clone(t,m.origin),n.Cartesian3.subtract(a,t,m.direction),n.Cartesian3.normalize(m.direction,m.direction);const d=f.rayTriangleParametric(m,i,r,s,c);if(!(!e.defined(d)||d<0||d>n.Cartesian3.distance(t,a)))return e.defined(l)||(l=new n.Cartesian3),n.Cartesian3.multiplyByScalar(m.direction,d,l),n.Cartesian3.add(m.origin,l,l)};const S={root0:0,root1:0};function O(t,a,r){e.defined(r)||(r=new i.Interval);const s=t.origin,c=t.direction,l=a.center,f=a.radius*a.radius,m=n.Cartesian3.subtract(s,l,g),d=function(t,n,e,a){const i=n*n-4*t*e;if(i<0)return;if(i>0){const e=1/(2*t),r=Math.sqrt(i),s=(-n+r)*e,c=(-n-r)*e;return s<c?(a.root0=s,a.root1=c):(a.root0=c,a.root1=s),a}const r=-n/(2*t);return 0!==r?(a.root0=a.root1=r,a):void 0}(n.Cartesian3.dot(c,c),2*n.Cartesian3.dot(c,m),n.Cartesian3.magnitudeSquared(m)-f,S);if(e.defined(d))return r.start=d.root0,r.stop=d.root1,r}f.raySphere=function(t,n,a){if(a=O(t,n,a),e.defined(a)&&!(a.stop<0))return a.start=Math.max(a.start,0),a};const x=new h;f.lineSegmentSphere=function(t,a,i,r){const s=x;n.Cartesian3.clone(t,s.origin);const c=n.Cartesian3.subtract(a,t,s.direction),l=n.Cartesian3.magnitude(c);if(n.Cartesian3.normalize(c,c),r=O(s,i,r),!(!e.defined(r)||r.stop<0||r.start>l))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,l),r};const y=new n.Cartesian3,P=new n.Cartesian3;function N(t,n,e){const a=t+n;return r.CesiumMath.sign(t)!==r.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}f.rayEllipsoid=function(t,e){const a=e.oneOverRadii,r=n.Cartesian3.multiplyComponents(a,t.origin,y),s=n.Cartesian3.multiplyComponents(a,t.direction,P),c=n.Cartesian3.magnitudeSquared(r),l=n.Cartesian3.dot(r,s);let f,m,d,g,p;if(c>1){if(l>=0)return;const t=l*l;if(f=c-1,m=n.Cartesian3.magnitudeSquared(s),d=m*f,t<d)return;if(t>d){g=l*l-d,p=-l+Math.sqrt(g);const t=p/m,n=f/p;return t<n?new i.Interval(t,n):{start:n,stop:t}}const e=Math.sqrt(f/m);return new i.Interval(e,e)}return c<1?(f=c-1,m=n.Cartesian3.magnitudeSquared(s),d=m*f,g=l*l-d,p=-l+Math.sqrt(g),new i.Interval(0,p/m)):l<0?(m=n.Cartesian3.magnitudeSquared(s),new i.Interval(0,-l/m)):void 0};const b=new n.Cartesian3,q=new n.Cartesian3,L=new n.Cartesian3,I=new n.Cartesian3,E=new n.Cartesian3,z=new n.Matrix3,T=new n.Matrix3,v=new n.Matrix3,U=new n.Matrix3,W=new n.Matrix3,B=new n.Matrix3,V=new n.Matrix3,Z=new n.Cartesian3,D=new n.Cartesian3,A=new n.Cartographic;f.grazingAltitudeLocation=function(t,a){const i=t.origin,c=t.direction;if(!n.Cartesian3.equals(i,n.Cartesian3.ZERO)){const t=a.geodeticSurfaceNormal(i,b);if(n.Cartesian3.dot(c,t)>=0)return i}const f=e.defined(this.rayEllipsoid(t,a)),m=a.transformPositionToScaledSpace(c,b),d=n.Cartesian3.normalize(m,m),g=n.Cartesian3.mostOrthogonalAxis(m,I),p=n.Cartesian3.normalize(n.Cartesian3.cross(g,d,q),q),w=n.Cartesian3.normalize(n.Cartesian3.cross(d,p,L),L),R=z;R[0]=d.x,R[1]=d.y,R[2]=d.z,R[3]=p.x,R[4]=p.y,R[5]=p.z,R[6]=w.x,R[7]=w.y,R[8]=w.z;const S=n.Matrix3.transpose(R,T),x=n.Matrix3.fromScale(a.radii,v),y=n.Matrix3.fromScale(a.oneOverRadii,U),P=W;P[0]=0,P[1]=-c.z,P[2]=c.y,P[3]=c.z,P[4]=0,P[5]=-c.x,P[6]=-c.y,P[7]=c.x,P[8]=0;const F=n.Matrix3.multiply(n.Matrix3.multiply(S,y,B),P,B),G=n.Matrix3.multiply(n.Matrix3.multiply(F,x,V),R,V),Y=n.Matrix3.multiplyByVector(F,i,E),_=function(t,e,a,i,c){const f=1*(t[n.Matrix3.COLUMN1ROW1]-t[n.Matrix3.COLUMN2ROW2]),m=1*(0*N(t[n.Matrix3.COLUMN1ROW0],t[n.Matrix3.COLUMN0ROW1],r.CesiumMath.EPSILON15)+e.y),d=0*t[n.Matrix3.COLUMN0ROW0]+1*t[n.Matrix3.COLUMN2ROW2]+0*e.x+0,g=1*N(t[n.Matrix3.COLUMN2ROW1],t[n.Matrix3.COLUMN1ROW2],r.CesiumMath.EPSILON15),p=1*(0*N(t[n.Matrix3.COLUMN2ROW0],t[n.Matrix3.COLUMN0ROW2])+e.z);let w;const R=[];if(0===p&&0===g){if(w=s.computeRealRoots(f,m,d),0===w.length)return R;const t=w[0],e=Math.sqrt(Math.max(1-t*t,0));if(R.push(new n.Cartesian3(0,1*t,1*-e)),R.push(new n.Cartesian3(0,1*t,1*e)),2===w.length){const t=w[1],e=Math.sqrt(Math.max(1-t*t,0));R.push(new n.Cartesian3(0,1*t,1*-e)),R.push(new n.Cartesian3(0,1*t,1*e))}return R}const S=p*p,x=g*g,y=p*g,P=f*f+x,b=2*(m*f+y),q=2*d*f+m*m-x+S,L=2*(d*m-y),I=d*d-S;if(0===P&&0===b&&0===q&&0===L)return R;w=l.computeRealRoots(P,b,q,L,I);const E=w.length;if(0===E)return R;for(let t=0;t<E;++t){const e=w[t],a=e*e,i=Math.max(1-a,0),s=Math.sqrt(i);let c;c=r.CesiumMath.sign(f)===r.CesiumMath.sign(d)?N(f*a+d,m*e,r.CesiumMath.EPSILON12):r.CesiumMath.sign(d)===r.CesiumMath.sign(m*e)?N(f*a,m*e+d,r.CesiumMath.EPSILON12):N(f*a+m*e,d,r.CesiumMath.EPSILON12);const l=c*N(g*e,p,r.CesiumMath.EPSILON15);l<0?R.push(new n.Cartesian3(0,1*e,1*s)):l>0?R.push(new n.Cartesian3(0,1*e,1*-s)):0!==s?(R.push(new n.Cartesian3(0,1*e,1*-s)),R.push(new n.Cartesian3(0,1*e,1*s)),++t):R.push(new n.Cartesian3(0,1*e,1*s))}return R}(G,n.Cartesian3.negate(Y,b));let j,k;const H=_.length;if(H>0){let t=n.Cartesian3.clone(n.Cartesian3.ZERO,D),e=Number.NEGATIVE_INFINITY;for(let a=0;a<H;++a){j=n.Matrix3.multiplyByVector(x,n.Matrix3.multiplyByVector(R,_[a],Z),Z);const r=n.Cartesian3.normalize(n.Cartesian3.subtract(j,i,I),I),s=n.Cartesian3.dot(r,c);s>e&&(e=s,t=n.Cartesian3.clone(j,t))}const s=a.cartesianToCartographic(t,A);return e=r.CesiumMath.clamp(e,0,1),k=n.Cartesian3.magnitude(n.Cartesian3.subtract(t,i,I))*Math.sqrt(1-e*e),k=f?-k:k,s.height=k,a.cartographicToCartesian(s,new n.Cartesian3)}};const F=new n.Cartesian3;f.lineSegmentPlane=function(t,a,i,s){e.defined(s)||(s=new n.Cartesian3);const c=n.Cartesian3.subtract(a,t,F),l=i.normal,f=n.Cartesian3.dot(l,c);if(Math.abs(f)<r.CesiumMath.EPSILON6)return;const m=n.Cartesian3.dot(l,t),d=-(i.distance+m)/f;return d<0||d>1?void 0:(n.Cartesian3.multiplyByScalar(c,d,s),n.Cartesian3.add(t,s,s),s)},f.trianglePlaneIntersection=function(t,e,a,i){const r=i.normal,s=i.distance,c=n.Cartesian3.dot(r,t)+s<0,l=n.Cartesian3.dot(r,e)+s<0,m=n.Cartesian3.dot(r,a)+s<0;let d,g,p=0;if(p+=c?1:0,p+=l?1:0,p+=m?1:0,1!==p&&2!==p||(d=new n.Cartesian3,g=new n.Cartesian3),1===p){if(c)return f.lineSegmentPlane(t,e,i,d),f.lineSegmentPlane(t,a,i,g),{positions:[t,e,a,d,g],indices:[0,3,4,1,2,4,1,4,3]};if(l)return f.lineSegmentPlane(e,a,i,d),f.lineSegmentPlane(e,t,i,g),{positions:[t,e,a,d,g],indices:[1,3,4,2,0,4,2,4,3]};if(m)return f.lineSegmentPlane(a,t,i,d),f.lineSegmentPlane(a,e,i,g),{positions:[t,e,a,d,g],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===p){if(!c)return f.lineSegmentPlane(e,t,i,d),f.lineSegmentPlane(a,t,i,g),{positions:[t,e,a,d,g],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return f.lineSegmentPlane(a,e,i,d),f.lineSegmentPlane(t,e,i,g),{positions:[t,e,a,d,g],indices:[2,0,4,2,4,3,1,3,4]};if(!m)return f.lineSegmentPlane(t,a,i,d),f.lineSegmentPlane(e,a,i,g),{positions:[t,e,a,d,g],indices:[0,1,4,0,4,3,2,3,4]}}},t.IntersectionTests=f,t.Ray=h}));
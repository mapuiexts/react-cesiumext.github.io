define(["exports","./Matrix3-b2351961","./defaultValue-f6d5e6da","./Transforms-f17097e5","./Math-355606c6"],(function(t,n,e,a,i){"use strict";const r={};function s(t,n,e){const a=t+n;return i.CesiumMath.sign(t)!==i.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}r.computeDiscriminant=function(t,n,e){return n*n-4*t*e},r.computeRealRoots=function(t,n,e){let a;if(0===t)return 0===n?[]:[-e/n];if(0===n){if(0===e)return[0,0];const n=Math.abs(e),r=Math.abs(t);if(n<r&&n/r<i.CesiumMath.EPSILON14)return[0,0];if(n>r&&r/n<i.CesiumMath.EPSILON14)return[];if(a=-e/t,a<0)return[];const o=Math.sqrt(a);return[-o,o]}if(0===e)return a=-n/t,a<0?[a,0]:[0,a];const r=s(n*n,-4*t*e,i.CesiumMath.EPSILON14);if(r<0)return[];const o=-.5*s(n,i.CesiumMath.sign(n)*Math.sqrt(r),i.CesiumMath.EPSILON14);return n>0?[o/t,e/o]:[e/o,o/t]};var o=r;const c={};function u(t,n,e,a){const i=t,r=n/3,o=e/3,c=a,l=i*o,C=r*c,m=r*r,d=o*o,g=i*o-m,p=i*c-r*o,w=r*c-d,R=4*g*w-p*p;let S,O;if(R<0){let t,n,e;m*C>=l*d?(t=i,n=g,e=-2*r*g+i*p):(t=c,n=w,e=-c*p+2*o*w);const a=-(e<0?-1:1)*Math.abs(t)*Math.sqrt(-R);O=-e+a;const x=O/2,P=x<0?-Math.pow(-x,1/3):Math.pow(x,1/3),N=O===a?-P:-n/P;return S=n<=0?P+N:-e/(P*P+N*N+n),m*C>=l*d?[(S-r)/i]:[-c/(S+o)]}const x=g,P=-2*r*g+i*p,N=w,b=-c*p+2*o*w,L=Math.sqrt(R),I=Math.sqrt(3)/2;let E=Math.abs(Math.atan2(i*L,-P)/3);S=2*Math.sqrt(-x);let v=Math.cos(E);O=S*v;let z=S*(-v/2-I*Math.sin(E));const T=O+z>2*r?O-r:z-r,U=i,W=T/U;E=Math.abs(Math.atan2(c*L,-b)/3),S=2*Math.sqrt(-N),v=Math.cos(E),O=S*v,z=S*(-v/2-I*Math.sin(E));const B=-c,V=O+z<2*o?O+o:z+o,Z=B/V,A=-T*V-U*B,D=(o*A-r*(T*B))/(-r*A+o*(U*V));return W<=D?W<=Z?D<=Z?[W,D,Z]:[W,Z,D]:[Z,W,D]:W<=Z?[D,W,Z]:D<=Z?[D,Z,W]:[Z,D,W]}c.computeDiscriminant=function(t,n,e,a){const i=n*n,r=e*e;return 18*t*n*e*a+i*r-t*t*27*(a*a)-4*(t*r*e+i*n*a)},c.computeRealRoots=function(t,n,e,a){let i,r;if(0===t)return o.computeRealRoots(n,e,a);if(0===n){if(0===e){if(0===a)return[0,0,0];r=-a/t;const n=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[n,n,n]}return 0===a?(i=o.computeRealRoots(t,0,e),0===i.Length?[0]:[i[0],0,i[1]]):u(t,0,e,a)}return 0===e?0===a?(r=-n/t,r<0?[r,0,0]:[0,0,r]):u(t,n,0,a):0===a?(i=o.computeRealRoots(t,n,e),0===i.length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]):u(t,n,e,a)};var l=c;const C={};function M(t,n,e,a){const r=t*t,c=n-3*r/8,C=e-n*t/2+r*t/8,m=a-e*t/4+n*r/16-3*r*r/256,d=l.computeRealRoots(1,2*c,c*c-4*m,-C*C);if(d.length>0){const n=-t/4,e=d[d.length-1];if(Math.abs(e)<i.CesiumMath.EPSILON14){const t=o.computeRealRoots(1,c,m);if(2===t.length){const e=t[0],a=t[1];let i;if(e>=0&&a>=0){const t=Math.sqrt(e),i=Math.sqrt(a);return[n-i,n-t,n+t,n+i]}if(e>=0&&a<0)return i=Math.sqrt(e),[n-i,n+i];if(e<0&&a>=0)return i=Math.sqrt(a),[n-i,n+i]}return[]}if(e>0){const t=Math.sqrt(e),a=(c+e-C/t)/2,i=(c+e+C/t)/2,r=o.computeRealRoots(1,t,a),l=o.computeRealRoots(1,-t,i);return 0!==r.length?(r[0]+=n,r[1]+=n,0!==l.length?(l[0]+=n,l[1]+=n,r[1]<=l[0]?[r[0],r[1],l[0],l[1]]:l[1]<=r[0]?[l[0],l[1],r[0],r[1]]:r[0]>=l[0]&&r[1]<=l[1]?[l[0],r[0],r[1],l[1]]:l[0]>=r[0]&&l[1]<=r[1]?[r[0],l[0],l[1],r[1]]:r[0]>l[0]&&r[0]<l[1]?[l[0],r[0],l[1],r[1]]:[r[0],l[0],r[1],l[1]]):r):0!==l.length?(l[0]+=n,l[1]+=n,l):[]}}return[]}function h(t,n,e,a){const r=t*t,c=-2*n,C=e*t+n*n-4*a,m=r*a-e*n*t+e*e,d=l.computeRealRoots(1,c,C,m);if(d.length>0){const c=d[0],l=n-c,C=l*l,m=t/2,g=l/2,p=C-4*a,w=C+4*Math.abs(a),R=r-4*c,S=r+4*Math.abs(c);let O,x,P,N,b,L;if(c<0||p*S<R*w){const n=Math.sqrt(R);O=n/2,x=0===n?0:(t*g-e)/n}else{const n=Math.sqrt(p);O=0===n?0:(t*g-e)/n,x=n/2}0===m&&0===O?(P=0,N=0):i.CesiumMath.sign(m)===i.CesiumMath.sign(O)?(P=m+O,N=c/P):(N=m-O,P=c/N),0===g&&0===x?(b=0,L=0):i.CesiumMath.sign(g)===i.CesiumMath.sign(x)?(b=g+x,L=a/b):(L=g-x,b=a/L);const I=o.computeRealRoots(1,P,b),E=o.computeRealRoots(1,N,L);if(0!==I.length)return 0!==E.length?I[1]<=E[0]?[I[0],I[1],E[0],E[1]]:E[1]<=I[0]?[E[0],E[1],I[0],I[1]]:I[0]>=E[0]&&I[1]<=E[1]?[E[0],I[0],I[1],E[1]]:E[0]>=I[0]&&E[1]<=I[1]?[I[0],E[0],E[1],I[1]]:I[0]>E[0]&&I[0]<E[1]?[E[0],I[0],E[1],I[1]]:[I[0],E[0],I[1],E[1]]:I;if(0!==E.length)return E}return[]}C.computeDiscriminant=function(t,n,e,a,i){const r=t*t,o=n*n,c=o*n,l=e*e,C=l*e,m=a*a,d=m*a,g=i*i;return o*l*m-4*c*d-4*t*C*m+18*t*n*e*d-27*r*m*m+r*t*256*(g*i)+i*(18*c*e*a-4*o*C+16*t*l*l-80*t*n*l*a-6*t*o*m+144*r*e*m)+g*(144*t*o*e-27*o*o-128*r*l-192*r*n*a)},C.computeRealRoots=function(t,n,e,a,r){if(Math.abs(t)<i.CesiumMath.EPSILON15)return l.computeRealRoots(n,e,a,r);const o=n/t,c=e/t,C=a/t,m=r/t;let d=o<0?1:0;switch(d+=c<0?d+1:d,d+=C<0?d+1:d,d+=m<0?d+1:d,d){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return M(o,c,C,m);case 1:case 2:case 5:case 8:case 11:return h(o,c,C,m);default:return}};var m=C;function f(t,a){a=n.Cartesian3.clone(e.defaultValue(a,n.Cartesian3.ZERO)),n.Cartesian3.equals(a,n.Cartesian3.ZERO)||n.Cartesian3.normalize(a,a),this.origin=n.Cartesian3.clone(e.defaultValue(t,n.Cartesian3.ZERO)),this.direction=a}f.clone=function(t,a){if(e.defined(t))return e.defined(a)?(a.origin=n.Cartesian3.clone(t.origin),a.direction=n.Cartesian3.clone(t.direction),a):new f(t.origin,t.direction)},f.getPoint=function(t,a,i){return e.defined(i)||(i=new n.Cartesian3),i=n.Cartesian3.multiplyByScalar(t.direction,a,i),n.Cartesian3.add(t.origin,i,i)};const d={rayPlane:function(t,a,r){e.defined(r)||(r=new n.Cartesian3);const o=t.origin,c=t.direction,l=a.normal,C=n.Cartesian3.dot(l,c);if(Math.abs(C)<i.CesiumMath.EPSILON15)return;const m=(-a.distance-n.Cartesian3.dot(l,o))/C;return m<0?void 0:(r=n.Cartesian3.multiplyByScalar(c,m,r),n.Cartesian3.add(o,r,r))}},g=new n.Cartesian3,p=new n.Cartesian3,w=new n.Cartesian3,R=new n.Cartesian3,S=new n.Cartesian3;d.rayTriangleParametric=function(t,a,r,o,c){c=e.defaultValue(c,!1);const l=t.origin,C=t.direction,m=n.Cartesian3.subtract(r,a,g),d=n.Cartesian3.subtract(o,a,p),O=n.Cartesian3.cross(C,d,w),x=n.Cartesian3.dot(m,O);let P,N,b,L,I;if(c){if(x<i.CesiumMath.EPSILON6)return;if(P=n.Cartesian3.subtract(l,a,R),b=n.Cartesian3.dot(P,O),b<0||b>x)return;if(N=n.Cartesian3.cross(P,m,S),L=n.Cartesian3.dot(C,N),L<0||b+L>x)return;I=n.Cartesian3.dot(d,N)/x}else{if(Math.abs(x)<i.CesiumMath.EPSILON6)return;const t=1/x;if(P=n.Cartesian3.subtract(l,a,R),b=n.Cartesian3.dot(P,O)*t,b<0||b>1)return;if(N=n.Cartesian3.cross(P,m,S),L=n.Cartesian3.dot(C,N)*t,L<0||b+L>1)return;I=n.Cartesian3.dot(d,N)*t}return I},d.rayTriangle=function(t,a,i,r,o,c){const l=d.rayTriangleParametric(t,a,i,r,o);if(e.defined(l)&&!(l<0))return e.defined(c)||(c=new n.Cartesian3),n.Cartesian3.multiplyByScalar(t.direction,l,c),n.Cartesian3.add(t.origin,c,c)};const O=new f;d.lineSegmentTriangle=function(t,a,i,r,o,c,l){const C=O;n.Cartesian3.clone(t,C.origin),n.Cartesian3.subtract(a,t,C.direction),n.Cartesian3.normalize(C.direction,C.direction);const m=d.rayTriangleParametric(C,i,r,o,c);if(!(!e.defined(m)||m<0||m>n.Cartesian3.distance(t,a)))return e.defined(l)||(l=new n.Cartesian3),n.Cartesian3.multiplyByScalar(C.direction,m,l),n.Cartesian3.add(C.origin,l,l)};const x={root0:0,root1:0};function y(t,i,r){e.defined(r)||(r=new a.Interval);const o=t.origin,c=t.direction,l=i.center,C=i.radius*i.radius,m=n.Cartesian3.subtract(o,l,w),d=function(t,n,e,a){const i=n*n-4*t*e;if(i<0)return;if(i>0){const e=1/(2*t),r=Math.sqrt(i),o=(-n+r)*e,c=(-n-r)*e;return o<c?(a.root0=o,a.root1=c):(a.root0=c,a.root1=o),a}const r=-n/(2*t);return 0!==r?(a.root0=a.root1=r,a):void 0}(n.Cartesian3.dot(c,c),2*n.Cartesian3.dot(c,m),n.Cartesian3.magnitudeSquared(m)-C,x);if(e.defined(d))return r.start=d.root0,r.stop=d.root1,r}d.raySphere=function(t,n,a){if(a=y(t,n,a),e.defined(a)&&!(a.stop<0))return a.start=Math.max(a.start,0),a};const P=new f;d.lineSegmentSphere=function(t,a,i,r){const o=P;n.Cartesian3.clone(t,o.origin);const c=n.Cartesian3.subtract(a,t,o.direction),l=n.Cartesian3.magnitude(c);if(n.Cartesian3.normalize(c,c),r=y(o,i,r),!(!e.defined(r)||r.stop<0||r.start>l))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,l),r};const N=new n.Cartesian3,b=new n.Cartesian3;function q(t,n,e){const a=t+n;return i.CesiumMath.sign(t)!==i.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}d.rayEllipsoid=function(t,e){const i=e.oneOverRadii,r=n.Cartesian3.multiplyComponents(i,t.origin,N),o=n.Cartesian3.multiplyComponents(i,t.direction,b),c=n.Cartesian3.magnitudeSquared(r),l=n.Cartesian3.dot(r,o);let C,m,d,g,p;if(c>1){if(l>=0)return;const t=l*l;if(C=c-1,m=n.Cartesian3.magnitudeSquared(o),d=m*C,t<d)return;if(t>d){g=l*l-d,p=-l+Math.sqrt(g);const t=p/m,n=C/p;return t<n?new a.Interval(t,n):{start:n,stop:t}}const e=Math.sqrt(C/m);return new a.Interval(e,e)}return c<1?(C=c-1,m=n.Cartesian3.magnitudeSquared(o),d=m*C,g=l*l-d,p=-l+Math.sqrt(g),new a.Interval(0,p/m)):l<0?(m=n.Cartesian3.magnitudeSquared(o),new a.Interval(0,-l/m)):void 0};const L=new n.Cartesian3,I=new n.Cartesian3,E=new n.Cartesian3,v=new n.Cartesian3,z=new n.Cartesian3,T=new n.Matrix3,U=new n.Matrix3,W=new n.Matrix3,B=new n.Matrix3,V=new n.Matrix3,Z=new n.Matrix3,A=new n.Matrix3,D=new n.Cartesian3,F=new n.Cartesian3,G=new n.Cartographic;d.grazingAltitudeLocation=function(t,a){const r=t.origin,c=t.direction;if(!n.Cartesian3.equals(r,n.Cartesian3.ZERO)){const t=a.geodeticSurfaceNormal(r,L);if(n.Cartesian3.dot(c,t)>=0)return r}const l=e.defined(this.rayEllipsoid(t,a)),C=a.transformPositionToScaledSpace(c,L),d=n.Cartesian3.normalize(C,C),g=n.Cartesian3.mostOrthogonalAxis(C,v),p=n.Cartesian3.normalize(n.Cartesian3.cross(g,d,I),I),w=n.Cartesian3.normalize(n.Cartesian3.cross(d,p,E),E),R=T;R[0]=d.x,R[1]=d.y,R[2]=d.z,R[3]=p.x,R[4]=p.y,R[5]=p.z,R[6]=w.x,R[7]=w.y,R[8]=w.z;const S=n.Matrix3.transpose(R,U),O=n.Matrix3.fromScale(a.radii,W),x=n.Matrix3.fromScale(a.oneOverRadii,B),P=V;P[0]=0,P[1]=-c.z,P[2]=c.y,P[3]=c.z,P[4]=0,P[5]=-c.x,P[6]=-c.y,P[7]=c.x,P[8]=0;const N=n.Matrix3.multiply(n.Matrix3.multiply(S,x,Z),P,Z),b=n.Matrix3.multiply(n.Matrix3.multiply(N,O,A),R,A),Y=n.Matrix3.multiplyByVector(N,r,z),_=function(t,e,a,r,c){const l=1*(t[n.Matrix3.COLUMN1ROW1]-t[n.Matrix3.COLUMN2ROW2]),C=1*(0*q(t[n.Matrix3.COLUMN1ROW0],t[n.Matrix3.COLUMN0ROW1],i.CesiumMath.EPSILON15)+e.y),d=0*t[n.Matrix3.COLUMN0ROW0]+1*t[n.Matrix3.COLUMN2ROW2]+0*e.x+0,g=1*q(t[n.Matrix3.COLUMN2ROW1],t[n.Matrix3.COLUMN1ROW2],i.CesiumMath.EPSILON15),p=1*(0*q(t[n.Matrix3.COLUMN2ROW0],t[n.Matrix3.COLUMN0ROW2])+e.z);let w;const R=[];if(0===p&&0===g){if(w=o.computeRealRoots(l,C,d),0===w.length)return R;const t=w[0],e=Math.sqrt(Math.max(1-t*t,0));if(R.push(new n.Cartesian3(0,1*t,1*-e)),R.push(new n.Cartesian3(0,1*t,1*e)),2===w.length){const t=w[1],e=Math.sqrt(Math.max(1-t*t,0));R.push(new n.Cartesian3(0,1*t,1*-e)),R.push(new n.Cartesian3(0,1*t,1*e))}return R}const S=p*p,O=g*g,x=p*g,P=l*l+O,N=2*(C*l+x),b=2*d*l+C*C-O+S,L=2*(d*C-x),I=d*d-S;if(0===P&&0===N&&0===b&&0===L)return R;w=m.computeRealRoots(P,N,b,L,I);const E=w.length;if(0===E)return R;for(let t=0;t<E;++t){const e=w[t],a=e*e,r=Math.max(1-a,0),o=Math.sqrt(r);let c;c=i.CesiumMath.sign(l)===i.CesiumMath.sign(d)?q(l*a+d,C*e,i.CesiumMath.EPSILON12):i.CesiumMath.sign(d)===i.CesiumMath.sign(C*e)?q(l*a,C*e+d,i.CesiumMath.EPSILON12):q(l*a+C*e,d,i.CesiumMath.EPSILON12);const m=c*q(g*e,p,i.CesiumMath.EPSILON15);m<0?R.push(new n.Cartesian3(0,1*e,1*o)):m>0?R.push(new n.Cartesian3(0,1*e,1*-o)):0!==o?(R.push(new n.Cartesian3(0,1*e,1*-o)),R.push(new n.Cartesian3(0,1*e,1*o)),++t):R.push(new n.Cartesian3(0,1*e,1*o))}return R}(b,n.Cartesian3.negate(Y,L));let j,k;const H=_.length;if(H>0){let t=n.Cartesian3.clone(n.Cartesian3.ZERO,F),e=Number.NEGATIVE_INFINITY;for(let a=0;a<H;++a){j=n.Matrix3.multiplyByVector(O,n.Matrix3.multiplyByVector(R,_[a],D),D);const i=n.Cartesian3.normalize(n.Cartesian3.subtract(j,r,v),v),o=n.Cartesian3.dot(i,c);o>e&&(e=o,t=n.Cartesian3.clone(j,t))}const o=a.cartesianToCartographic(t,G);return e=i.CesiumMath.clamp(e,0,1),k=n.Cartesian3.magnitude(n.Cartesian3.subtract(t,r,v))*Math.sqrt(1-e*e),k=l?-k:k,o.height=k,a.cartographicToCartesian(o,new n.Cartesian3)}};const Y=new n.Cartesian3;d.lineSegmentPlane=function(t,a,r,o){e.defined(o)||(o=new n.Cartesian3);const c=n.Cartesian3.subtract(a,t,Y),l=r.normal,C=n.Cartesian3.dot(l,c);if(Math.abs(C)<i.CesiumMath.EPSILON6)return;const m=n.Cartesian3.dot(l,t),d=-(r.distance+m)/C;return d<0||d>1?void 0:(n.Cartesian3.multiplyByScalar(c,d,o),n.Cartesian3.add(t,o,o),o)},d.trianglePlaneIntersection=function(t,e,a,i){const r=i.normal,o=i.distance,c=n.Cartesian3.dot(r,t)+o<0,l=n.Cartesian3.dot(r,e)+o<0,C=n.Cartesian3.dot(r,a)+o<0;let m,g,p=0;if(p+=c?1:0,p+=l?1:0,p+=C?1:0,1!==p&&2!==p||(m=new n.Cartesian3,g=new n.Cartesian3),1===p){if(c)return d.lineSegmentPlane(t,e,i,m),d.lineSegmentPlane(t,a,i,g),{positions:[t,e,a,m,g],indices:[0,3,4,1,2,4,1,4,3]};if(l)return d.lineSegmentPlane(e,a,i,m),d.lineSegmentPlane(e,t,i,g),{positions:[t,e,a,m,g],indices:[1,3,4,2,0,4,2,4,3]};if(C)return d.lineSegmentPlane(a,t,i,m),d.lineSegmentPlane(a,e,i,g),{positions:[t,e,a,m,g],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===p){if(!c)return d.lineSegmentPlane(e,t,i,m),d.lineSegmentPlane(a,t,i,g),{positions:[t,e,a,m,g],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return d.lineSegmentPlane(a,e,i,m),d.lineSegmentPlane(t,e,i,g),{positions:[t,e,a,m,g],indices:[2,0,4,2,4,3,1,3,4]};if(!C)return d.lineSegmentPlane(t,a,i,m),d.lineSegmentPlane(e,a,i,g),{positions:[t,e,a,m,g],indices:[0,1,4,0,4,3,2,3,4]}}};var _=d;t.IntersectionTests=_,t.Ray=f}));
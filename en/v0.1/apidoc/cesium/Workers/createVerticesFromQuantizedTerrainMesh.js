define(["./AxisAlignedBoundingBox-04c1a5e3","./Matrix2-7a8e9daf","./Matrix3-b2351961","./defaultValue-f6d5e6da","./TerrainEncoding-c5a10c4f","./IndexDatatype-a9b1bc18","./Math-355606c6","./Transforms-f17097e5","./WebMercatorProjection-db7467f4","./createTaskProcessorWorker","./RuntimeError-9b4ce3fb","./AttributeCompression-0b8f7b7d","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./combine-0c102d93"],(function(e,t,r,n,o,i,a,s,c,d,h,u,l,I,g){"use strict";function m(){s.DeveloperError.throwInstantiationError()}Object.defineProperties(m.prototype,{errorEvent:{get:s.DeveloperError.throwInstantiationError},credit:{get:s.DeveloperError.throwInstantiationError},tilingScheme:{get:s.DeveloperError.throwInstantiationError},ready:{get:s.DeveloperError.throwInstantiationError},readyPromise:{get:s.DeveloperError.throwInstantiationError},hasWaterMask:{get:s.DeveloperError.throwInstantiationError},hasVertexNormals:{get:s.DeveloperError.throwInstantiationError},availability:{get:s.DeveloperError.throwInstantiationError}});const T=[];m.getRegularGridIndices=function(e,t){let r=T[e];n.defined(r)||(T[e]=r=[]);let o=r[t];return n.defined(o)||(o=e*t<a.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),y(e,t,o,0)),o};const E=[];m.getRegularGridIndicesAndEdgeIndices=function(e,t){let r=E[e];n.defined(r)||(E[e]=r=[]);let o=r[t];if(!n.defined(o)){const n=m.getRegularGridIndices(e,t),i=f(e,t),a=i.westIndicesSouthToNorth,s=i.southIndicesEastToWest,c=i.eastIndicesNorthToSouth,d=i.northIndicesWestToEast;o=r[t]={indices:n,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:c,northIndicesWestToEast:d}}return o};const p=[];function f(e,t){const r=new Array(t),n=new Array(e),o=new Array(t),i=new Array(e);let a;for(a=0;a<e;++a)i[a]=a,n[a]=e*t-1-a;for(a=0;a<t;++a)o[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:i}}function y(e,t,r,n){let o=0;for(let i=0;i<t-1;++i){for(let t=0;t<e-1;++t){const t=o,i=t+e,a=i+1,s=t+1;r[n++]=t,r[n++]=i,r[n++]=s,r[n++]=s,r[n++]=i,r[n++]=a,++o}++o}}function N(e,t,r,n){let o=e[0];const i=e.length;for(let a=1;a<i;++a){const i=e[a];r[n++]=o,r[n++]=i,r[n++]=t,r[n++]=t,r[n++]=i,r[n++]=t+1,o=i,++t}return n}m.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){let r=p[e];n.defined(r)||(p[e]=r=[]);let o=r[t];if(!n.defined(o)){const n=e*t,a=(e-1)*(t-1)*6,s=2*e+2*t,c=n+s,d=a+6*Math.max(0,s-4),h=f(e,t),u=h.westIndicesSouthToNorth,l=h.southIndicesEastToWest,I=h.eastIndicesNorthToSouth,g=h.northIndicesWestToEast,T=i.IndexDatatype.createTypedArray(c,d);y(e,t,T,0),m.addSkirtIndices(u,l,I,g,n,T,a),o=r[t]={indices:T,westIndicesSouthToNorth:u,southIndicesEastToWest:l,eastIndicesNorthToSouth:I,northIndicesWestToEast:g,indexCountWithoutSkirts:a}}return o},m.addSkirtIndices=function(e,t,r,n,o,i,a){let s=o;a=N(e,s,i,a),s+=e.length,a=N(t,s,i,a),s+=t.length,a=N(r,s,i,a),s+=r.length,N(n,s,i,a)},m.heightmapTerrainQuality=.25,m.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*m.heightmapTerrainQuality/(t*r)},m.prototype.requestTileGeometry=s.DeveloperError.throwInstantiationError,m.prototype.getLevelMaximumGeometricError=s.DeveloperError.throwInstantiationError,m.prototype.getTileDataAvailable=s.DeveloperError.throwInstantiationError,m.prototype.loadTileDataAvailability=s.DeveloperError.throwInstantiationError;const w=32767,M=new r.Cartesian3,S=new r.Cartesian3,x=new r.Cartesian3,A=new r.Cartographic,C=new t.Cartesian2;function b(e,n,o,i,s,c,d,h,u){let l=Number.POSITIVE_INFINITY;const I=s.north,g=s.south;let T=s.east;const E=s.west;T<E&&(T+=a.CesiumMath.TWO_PI);const p=e.length;for(let s=0;s<p;++s){const p=e[s],w=o[p],S=i[p];A.longitude=a.CesiumMath.lerp(E,T,S.x),A.latitude=a.CesiumMath.lerp(g,I,S.y),A.height=w-n;const x=c.cartographicToCartesian(A,M);t.Matrix4.multiplyByPoint(d,x,x),r.Cartesian3.minimumByComponent(x,h,h),r.Cartesian3.maximumByComponent(x,u,u),l=Math.min(l,A.height)}return l}function W(e,t,r,o,i,s,d,h,u,l,I,g,T,E){const p=n.defined(d),w=u.north,S=u.south;let x=u.east;const P=u.west;x<P&&(x+=a.CesiumMath.TWO_PI);const D=r.length;for(let n=0;n<D;++n){const u=r[n],D=i[u],k=s[u];A.longitude=a.CesiumMath.lerp(P,x,k.x)+T,A.latitude=a.CesiumMath.lerp(S,w,k.y)+E,A.height=D-l;const F=h.cartographicToCartesian(A,M);if(p){const e=2*u;C.x=d[e],C.y=d[e+1]}let H,_;o.hasWebMercatorT&&(H=(c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(A.latitude)-I)*g),o.hasGeodeticSurfaceNormals&&(_=h.geodeticSurfaceNormal(F)),t=o.encode(e,t,F,k,A.height,C,H,_)}}function v(e,t){let r;return"function"==typeof e.slice&&(r=e.slice(),"function"!=typeof r.sort&&(r=void 0)),n.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return d((function(d,h){const u=d.quantizedVertices,l=u.length/3,I=d.octEncodedNormals,g=d.westIndices.length+d.eastIndices.length+d.southIndices.length+d.northIndices.length,T=d.includeWebMercatorT,E=d.exaggeration,p=d.exaggerationRelativeHeight,P=1!==E,D=t.Rectangle.clone(d.rectangle),k=D.west,F=D.south,H=D.east,_=D.north,G=r.Ellipsoid.clone(d.ellipsoid),V=d.minimumHeight,Y=d.maximumHeight,O=d.relativeToCenter,B=s.Transforms.eastNorthUpToFixedFrame(O,G),R=t.Matrix4.inverseTransformation(B,new t.Matrix4);let L,j;T&&(L=c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(F),j=1/(c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_)-L));const U=u.subarray(0,l),z=u.subarray(l,2*l),q=u.subarray(2*l,3*l),Q=n.defined(I),K=new Array(l),X=new Array(l),Z=new Array(l),J=T?new Array(l):[],$=P?new Array(l):[],ee=S;ee.x=Number.POSITIVE_INFINITY,ee.y=Number.POSITIVE_INFINITY,ee.z=Number.POSITIVE_INFINITY;const te=x;te.x=Number.NEGATIVE_INFINITY,te.y=Number.NEGATIVE_INFINITY,te.z=Number.NEGATIVE_INFINITY;let re=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,oe=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY;for(let e=0;e<l;++e){const n=U[e],o=z[e],i=n/w,s=o/w,d=a.CesiumMath.lerp(V,Y,q[e]/w);A.longitude=a.CesiumMath.lerp(k,H,i),A.latitude=a.CesiumMath.lerp(F,_,s),A.height=d,re=Math.min(A.longitude,re),ne=Math.max(A.longitude,ne),oe=Math.min(A.latitude,oe),ie=Math.max(A.latitude,ie);const h=G.cartographicToCartesian(A);K[e]=new t.Cartesian2(i,s),X[e]=d,Z[e]=h,T&&(J[e]=(c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(A.latitude)-L)*j),P&&($[e]=G.geodeticSurfaceNormal(h)),t.Matrix4.multiplyByPoint(R,h,M),r.Cartesian3.minimumByComponent(M,ee,ee),r.Cartesian3.maximumByComponent(M,te,te)}const ae=v(d.westIndices,(function(e,t){return K[e].y-K[t].y})),se=v(d.eastIndices,(function(e,t){return K[t].y-K[e].y})),ce=v(d.southIndices,(function(e,t){return K[t].x-K[e].x})),de=v(d.northIndices,(function(e,t){return K[e].x-K[t].x}));let he;V<0&&(he=new o.EllipsoidalOccluder(G).computeHorizonCullingPointPossiblyUnderEllipsoid(O,Z,V));let ue=V;ue=Math.min(ue,b(d.westIndices,d.westSkirtHeight,X,K,D,G,R,ee,te)),ue=Math.min(ue,b(d.southIndices,d.southSkirtHeight,X,K,D,G,R,ee,te)),ue=Math.min(ue,b(d.eastIndices,d.eastSkirtHeight,X,K,D,G,R,ee,te)),ue=Math.min(ue,b(d.northIndices,d.northSkirtHeight,X,K,D,G,R,ee,te));const le=new e.AxisAlignedBoundingBox(ee,te,O),Ie=new o.TerrainEncoding(O,le,ue,Y,B,Q,T,P,E,p),me=Ie.stride,ge=new Float32Array(l*me+g*me);let Te=0;for(let e=0;e<l;++e){if(Q){const t=2*e;C.x=I[t],C.y=I[t+1]}Te=Ie.encode(ge,Te,Z[e],K[e],X[e],C,J[e],$[e])}const fe=Math.max(0,2*(g-4)),Ee=d.indices.length+3*fe,pe=i.IndexDatatype.createTypedArray(l+g,Ee);pe.set(d.indices,0);const ye=1e-4,Ne=(ne-re)*ye,we=(ie-oe)*ye,be=-Ne,Me=Ne,Se=we,xe=-we;let Ae=l*me;return W(ge,Ae,ae,Ie,X,K,I,G,D,d.westSkirtHeight,L,j,be,0),Ae+=d.westIndices.length*me,W(ge,Ae,ce,Ie,X,K,I,G,D,d.southSkirtHeight,L,j,0,xe),Ae+=d.southIndices.length*me,W(ge,Ae,se,Ie,X,K,I,G,D,d.eastSkirtHeight,L,j,Me,0),Ae+=d.eastIndices.length*me,W(ge,Ae,de,Ie,X,K,I,G,D,d.northSkirtHeight,L,j,0,Se),m.addSkirtIndices(ae,ce,se,de,l,pe,d.indices.length),h.push(ge.buffer,pe.buffer),{vertices:ge.buffer,indices:pe.buffer,westIndicesSouthToNorth:ae,southIndicesEastToWest:ce,eastIndicesNorthToSouth:se,northIndicesWestToEast:de,vertexStride:me,center:O,minimumHeight:V,maximumHeight:Y,occludeePointInScaledSpace:he,encoding:Ie,indexCountWithoutSkirts:d.indices.length}}))}));